<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.0.1/luxon.min.js"></script>
    <title>NCI Team and Course Information</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <main>
        <header></header>

        <div class="team_times">
            <table class="team_table">
                <thead>
                    <tr>
                        <th>Team Member</th>
                        <th>Local Time & Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for person in people_times %}
                    <tr>
                        <td class="member">{{ person.name }}</td>
                        <td class="local_time">{{ person.current_time }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="live_schedule">
            {% for course, times in qna_times.items() %}
            <table class="{{ course | lower | replace(' ', '_') }}_table">
                <thead>
                    <tr>
                        <th class="schedule_heading" colspan="3">{{ course }}</th>
                    </tr>
                    <tr>
                        <th>Mon</th>
                        <th>Wed</th>
                        <th>Thur</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-time="{{ times.Mon }}">{ { times.Mon } E.S.T. }</td>
                        <td data-time="{{ times.Wed }}">{ { times.Wed } E.S.T. }</td>
                        <td data-time="{{ times.Thur }}">{ { times.Thur } E.S.T. }</td>
                    </tr>
                </tbody>
            </table>
            {% endfor %}
        </div>

        <div class="timezone_selector">
            <label for="timezone">Select your timezone:</label>
            <select id="timezone">
                <!-- <option value="" selected disabled>Choose a timezone</option> -->
                <option value="America/New_York" selected>Eastern Time (US & Canada)</option>
                <option value="America/Chicago">Central Time (US & Canada)</option>
                <option value="America/Denver">Mountain Time (US & Canada)</option>
                <option value="America/Los_Angeles">Pacific Time (US & Canada)</option>
                <option value="Europe/London">London</option>
                <option value="Europe/Paris">Paris</option>
                <option value="Australia/Sydney">Sydney</option>
                <option value="Australia/Brisbane">Brisbane</option>
            </select>
        </div>

        <script>
            document.getElementById('timezone').addEventListener('change', function () {
                let selectedTimezone = this.value;
        
                if (selectedTimezone) {
                    // Using Luxon to convert times correctly
                    const DateTime = luxon.DateTime;
        
                    document.querySelectorAll('[data-time]').forEach(function (element) {
                        // Get the original EST time
                        let estTime = element.getAttribute('data-time'); // Time in EST (HH:mm format)
                        let [hours, minutes] = estTime.split(':');
        
                        // Create DateTime object in EST
                        let estDateTime = DateTime.fromObject(
                            { hour: parseInt(hours), minute: parseInt(minutes) },
                            { zone: 'America/New_York' }
                        );
        
                        // Convert to the selected timezone
                        let localTime = estDateTime.setZone(selectedTimezone);
        
                        // Format the time in HH:mm format
                        element.innerHTML = `${localTime.toFormat('h:mm a')}`;
                    });
                }
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Trigger the change event to set initial time conversion
                let timezoneSelect = document.getElementById('timezone');
                if (timezoneSelect.value) {
                    timezoneSelect.dispatchEvent(new Event('change'));
                }
            });
        </script>
        

        <footer></footer>
    </main>
</body>
</html>
